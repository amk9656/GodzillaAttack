<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Godzilla Attack</title>
        <link rel="stylesheet" href="styles/normalize.css">
        <link rel="stylesheet" href="styles/style.css">
		<script src = "scripts/Godzilla.js"></script>
		<script src = "scripts/Bullet.js"></script>
		<script src = "scripts/Drawing.js"></script>
		<script src = "scripts/Levels.js"></script>
		<script src = "scripts/Enemies.js"></script>
		<script src = "scripts/utils.js"></script>
		<script>
		"use strict";
		
		window.addEventListener("load",loadImages);
		
		var CANVAS_WIDTH = 640,
			CANVAS_HEIGHT = 480;
		
		var IMAGE_SOURCES = {
		playerImage: "",
		enemyImage: "",
		buildingImage: ""
	};

		var ctx;
		var spawnTime = 0;
		var shootTime = 0;
		var godzilla,
			helicopter = [],
			heliBullets = [],
			level;		
		

		function initGame()
		{
			
			var canvasElement = document.querySelector("#canvas");
			canvasElement.width = CANVAS_WIDTH;
			canvasElement.height = CANVAS_HEIGHT;
			ctx = canvasElement.getContext("2d");
			godzilla = new Godzilla();
			helicopter.push(new Helicopter());
			level = new Level("3x3");

			Animate();
		}
		
		function loadImages(){
		var numLoadedImages = 0;
		var numImages = 0;		
		for (var imageName in IMAGE_SOURCES){
			numImages++;
			}
			for(var imageName in IMAGE_SOURCES){
				console.log("Sarted loading " + imageName);
				images[imageName] = new Image(); 
				images[imageName].src = IMAGE_SOURCES[imageName];
				
				images[imageName].onload = function(){
				console.log(this.src + " load complete");
				if(++numLoadedImages >= numImages){
				console.log("Done loading images");
				initGame(); 
				}
			}; 
		} 
	} 	
		
		function shoot(x, y)
		{			
			heliBullets.push(new Bullet(x,y,2))
		}
		
		function update(deltaTime)
		{
			//console.log(shootTime);			
			if(helicopter.length < 3)
			{
				spawnTime += deltaTime;
			}
			godzilla.update(deltaTime);
			helicopter.forEach(function(heli)
			{
				heli.update(deltaTime);
			});
			helicopter = helicopter.filter(function(heli){
			return heli.active;
			});
			
			helicopter.forEach(function(heli)
			{
				shootTime += deltaTime;
				if(shootTime >= 4)
				{
					console.log(heliBullets);
					shoot(heli.x,heli.y);
					shootTime = 0;
				}
			});
			
			heliBullets.forEach(function(bullet){
				bullet.update(deltaTime);
			});
			
			heliBullets = heliBullets.filter(function(bullet){
				return bullet.active;
				});
		}
		</script>
	</head>
	<body>
		<header id="game_header" class="shadow">
			Godzilla Attack
		</header>
		<section id="game" class="shadow">
			<canvas id="canvas"></canvas>
		</section>
		<footer id="footer">
        	Andrew Kaufman & Nelson Liu; New Media Web Tech II Spring 2012; Project I
        </footer>
	</body>
</html>